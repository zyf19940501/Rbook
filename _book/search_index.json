[["stringr.html", "5 stringr", " 5 stringr 实际工作中,经常需要处理字符串.R包stringr处理字符相对简单,本章记录工作中常用的字符处理方式方法。 本文部分案例照搬R for Data Science的字符部分。 Excle中自带的字符函数如: left,len,mid,find,Proper,rept,trim,upper,substitute,concatenate,以及Excle2019新出的concat,TEXTJOIN等函数，新出的textjoin函数我个人比较喜欢用。 学习的时候可以先用stringr包实现以上相对应功能。 https://cran.r-project.org/web/packages/stringr/vignettes/stringr.html "],["基础-4.html", "5.1 基础", " 5.1 基础 字符串处理的难点，个人觉得在于【正则表达式】的掌握程度，但是需要用到正则表达式时都是比较复杂的字符处理工作，在实际商业文本数据中 运用较多。对大部分常规商业数据分析工作者的面对的表格数据而言，字符处理可能仅仅只是合并、剔除、删除空格、倒叙等基础操作。 5.1.1 单双引号 R语言中字符串输入时，可以使用单引号，也可以使用双引号。 单双引号用法和意义没有差别 R中推荐使用双引号分隔符，打印、显示时都是用双引号 单引号字符串通常用在字符串内包含双引号时，如用R执行sql字符串代码时 5.1.2 转义 要在字符串中包含单引号或双引号，可以使用 转义它，即遇到特殊符号时需要转义。 #install.packages(&#39;stringr&#39;) library(stringr) char &lt;- &quot;我是一名\\&#39;小学生\\&#39;&quot; #字符串建议用双引号包裹,单引号也可以 char #&gt; [1] &quot;我是一名&#39;小学生&#39;&quot; 打印会显示转义符。要查看字符串的原始内容,可使用writeLines()或cat() x &lt;- c(&quot;\\&quot;&quot;, &quot;\\\\&quot;) x #&gt; [1] &quot;\\&quot;&quot; &quot;\\\\&quot; writeLines(x) cat(char) #&gt; &quot; #&gt; \\ 在正则表达式中 有特殊含义,有时需要两个 ，多体会下面这段，代码实现移除“||”的功能。 str_remove(string = &#39;a||b&#39;,pattern = &quot;\\\\|\\\\|&quot;) #&gt; [1] &quot;ab&quot; 另外常见的\\n, \\t需要被转义处理,在字符清洗,如小说语义分析,网页爬虫后整理等数据清洗过程中经常用到. 5.1.3 字符串长度 char &lt;- &quot;我是R语言学习者&quot; str_length(char) #&gt; [1] 8 # 向量化 str_length(c(&quot;a&quot;, &quot;R for data science&quot;, NA)) #&gt; [1] 1 18 NA 5.1.4 连接字符串 R中字符串不像python中可以用加号连接字符串,如下所示: R 版本 #base R paste0(&#39;a&#39;,&#39;b&#39;) #&gt; [1] &quot;ab&quot; #stringr str_c(&quot;a&quot;,&quot;b&quot;) #&gt; [1] &quot;ab&quot; str_c(&quot;a&quot;, &quot;b&quot;, sep = &quot;, &quot;) #sep 参数控制分隔符 #&gt; [1] &quot;a, b&quot; Python 版本 &#39;a&#39; + &#39;b&#39; #&gt; &#39;ab&#39; 多个字符串合并为一个字符,stringr中的函数都是向量化的，合并一个和多个字符都是同样道理。 #base R paste0(c(&#39;a&#39;,&#39;b&#39;,&#39;d&#39;,&#39;e&#39;),collapse = &#39;,&#39;) #&gt; [1] &quot;a,b,d,e&quot; #stringr str_c(c(&#39;a&#39;,&#39;b&#39;,&#39;d&#39;,&#39;e&#39;),collapse = &#39;,&#39;) #collapse 参数控制 #&gt; [1] &quot;a,b,d,e&quot; 实际运用案例 合并 library(data.table) dt &lt;- data.table(col=rep(&#39;a&#39;,10),letters=letters[1:10]) dt[,newcol:=str_c(letters,collapse = &#39;|&#39;),by=.(col)][] #&gt; col letters newcol #&gt; 1: a a a|b|c|d|e|f|g|h|i|j #&gt; 2: a b a|b|c|d|e|f|g|h|i|j #&gt; 3: a c a|b|c|d|e|f|g|h|i|j #&gt; 4: a d a|b|c|d|e|f|g|h|i|j #&gt; 5: a e a|b|c|d|e|f|g|h|i|j #&gt; 6: a f a|b|c|d|e|f|g|h|i|j #&gt; 7: a g a|b|c|d|e|f|g|h|i|j #&gt; 8: a h a|b|c|d|e|f|g|h|i|j #&gt; 9: a i a|b|c|d|e|f|g|h|i|j #&gt; 10: a j a|b|c|d|e|f|g|h|i|j 拆解 #工作中路径需要拆解 类似商品品类路径 进口水果-热带水果-生鲜,用户行为路径等 dt &lt;- data.table(col=&#39;a&#39;,letters=str_c(letters[1:10],collapse = &#39;|&#39;)) my_str_split &lt;- function(x){ str_split(x,pattern = &quot;\\\\|&quot;) %&gt;% unlist() #str_split 拆解出来是列表 需要向量化 } dt[,list(newcol=my_str_split(letters)),by=.(col)] #&gt; col newcol #&gt; 1: a a #&gt; 2: a b #&gt; 3: a c #&gt; 4: a d #&gt; 5: a e #&gt; 6: a f #&gt; 7: a g #&gt; 8: a h #&gt; 9: a i #&gt; 10: a j 5.1.5 R4.0后新特性 新特性 char &lt;- r&quot;(\\\\a\\ab\\d\\e\\f)&quot; #windows下路径好用,不用转义路径复制和直接可用 char #&gt; [1] &quot;\\\\\\\\a\\\\ab\\\\d\\\\e\\\\f&quot; char &lt;- &quot;我是一名\\&#39;小学生\\&#39;&quot; cat(char) #&gt; 我是一名&#39;小学生&#39; char &lt;- r&quot;(我是一名&#39;R语言&#39;学习者)&quot; cat(char) #&gt; 我是一名&#39;R语言&#39;学习者 "],["常用函数-1.html", "5.2 常用函数", " 5.2 常用函数 5.2.1 截取 与Excle中left,mid,right函数功能类似 str_sub() 函数 三个参数: string:需要被截取的字符串 start: 默认1L,即从最开始截取 end:默认-1L,即截取到最后 #注意end 3 和 -3的区别 str_sub(string = &#39;我是R语言学习者&#39;,start = 2,end = 3) #&gt; [1] &quot;是R&quot; str_sub(string = &#39;我是R语言学习者&#39;,start = 2,end = -3) #&gt; [1] &quot;是R语言学&quot; 5.2.2 匹配 查看函数帮助文档,str_match()按照指定pattern(正则表达式)查找字符.重点困难点正则表达式的编写. ?str_match() ?str_match_all() ?str_extract() ?str_extract_all() str_extract()函数返回向量,str_match()函数返回矩阵. #原文来源烽火戏诸侯的&lt;剑来&gt; strings &lt;- c(&#39;陈平安放下新折的那根桃枝,吹灭蜡烛,走出屋子后,坐在台阶上,仰头望去,星空璀璨.&#39;) str_extract(strings,&#39;陈平安&#39;) #&gt; [1] &quot;陈平安&quot; str_match(strings,&#39;陈平安&#39;) #&gt; [,1] #&gt; [1,] &quot;陈平安&quot; 匹配中文 匹配中文的正则表达式\\[\\u4e00-\\u9fa5\\] str_extract_all(strings,&#39;[\\u4e00-\\u9fa5]&#39;) #返回list #&gt; [[1]] #&gt; [1] &quot;陈&quot; &quot;平&quot; &quot;安&quot; &quot;放&quot; &quot;下&quot; &quot;新&quot; &quot;折&quot; &quot;的&quot; &quot;那&quot; &quot;根&quot; &quot;桃&quot; &quot;枝&quot; &quot;吹&quot; &quot;灭&quot; &quot;蜡&quot; #&gt; [16] &quot;烛&quot; &quot;走&quot; &quot;出&quot; &quot;屋&quot; &quot;子&quot; &quot;后&quot; &quot;坐&quot; &quot;在&quot; &quot;台&quot; &quot;阶&quot; &quot;上&quot; &quot;仰&quot; &quot;头&quot; &quot;望&quot; &quot;去&quot; #&gt; [31] &quot;星&quot; &quot;空&quot; &quot;璀&quot; &quot;璨&quot; 匹配数字或英文 查找数字的正则表达式[0-9];查找英文的正则表达式:[a-zA-Z] strings &lt;- c(&#39;00123545&#39;,&#39;LOL league of legends&#39;) str_extract_all(strings,&#39;[0-9]&#39;) #&gt; [[1]] #&gt; [1] &quot;0&quot; &quot;0&quot; &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;5&quot; &quot;4&quot; &quot;5&quot; #&gt; #&gt; [[2]] #&gt; character(0) str_extract_all(strings,&#39;[a-zA-Z]&#39;) #&gt; [[1]] #&gt; character(0) #&gt; #&gt; [[2]] #&gt; [1] &quot;L&quot; &quot;O&quot; &quot;L&quot; &quot;l&quot; &quot;e&quot; &quot;a&quot; &quot;g&quot; &quot;u&quot; &quot;e&quot; &quot;o&quot; &quot;f&quot; &quot;l&quot; &quot;e&quot; &quot;g&quot; &quot;e&quot; &quot;n&quot; &quot;d&quot; &quot;s&quot; 5.2.3 添加字符 str_pad() 函数向字符串添加字符 像工作中处理月份的时候,1,2,3,4,5,6,7,8,9,10,11,12变成01,02,03,04,05,06,07,08,09,10,11,12.按照日期时间输出文件名称,如下所示: str_pad(string = 1:12,width = 2,side = &#39;left&#39;,pad = &#39;0&#39;) #&gt; [1] &quot;01&quot; &quot;02&quot; &quot;03&quot; &quot;04&quot; &quot;05&quot; &quot;06&quot; &quot;07&quot; &quot;08&quot; &quot;09&quot; &quot;10&quot; &quot;11&quot; &quot;12&quot; 5.2.4 去除空格 与excel中trim函数功能类似，剔除字符中的空格，但是不可以剔除字符中的空格 # side 可选 both left right str_trim(&#39; ab af &#39;,side = &#39;both&#39;) #&gt; [1] &quot;ab af&quot; 5.2.5 分割字符 str_split()处理后的结果是列表 # 得到列表,需要向量化 str_split(&quot;a,b,d,e&quot;,pattern = &#39;,&#39;) #&gt; [[1]] #&gt; [1] &quot;a&quot; &quot;b&quot; &quot;d&quot; &quot;e&quot; str_split(&#39;ab||cd&#39;,&#39;\\\\|\\\\|&#39;) %&gt;% unlist() #&gt; [1] &quot;ab&quot; &quot;cd&quot; # same above #str_split(&#39;ab||cd&#39;,&#39;\\\\|\\\\|&#39;) %&gt;% purrr::as_vector() 当待处理的字符串是字符串向量时，得到的列表长度与向量长度一致 fruits &lt;- c( &quot;apples and oranges and pears and bananas&quot;, &quot;pineapples and mangos and guavas&quot; ) str_split(fruits, &quot; and &quot;) #&gt; [[1]] #&gt; [1] &quot;apples&quot; &quot;oranges&quot; &quot;pears&quot; &quot;bananas&quot; #&gt; #&gt; [[2]] #&gt; [1] &quot;pineapples&quot; &quot;mangos&quot; &quot;guavas&quot; 5.2.6 替换字符 str_replace()，str_replace_all()函数用来替换字符 fruits &lt;- c(&quot;one apple&quot;, &quot;two pears&quot;, &quot;three bananas&quot;) str_replace(fruits, &quot;[aeiou]&quot;, &quot;-&quot;) #&gt; [1] &quot;-ne apple&quot; &quot;tw- pears&quot; &quot;thr-e bananas&quot; str_replace_all(fruits, &quot;[aeiou]&quot;, &quot;-&quot;) #&gt; [1] &quot;-n- -ppl-&quot; &quot;tw- p--rs&quot; &quot;thr-- b-n-n-s&quot; 5.2.7 移除字符 str_remove(),str_remove_all()移除字符。本人常用该函数剔除文本中的空格。 fruits &lt;- c(&quot;one apple&quot;, &quot;two pears&quot;, &quot;three bananas&quot;) str_remove(fruits, &quot;[aeiou]&quot;) #&gt; [1] &quot;ne apple&quot; &quot;tw pears&quot; &quot;thre bananas&quot; str_remove_all(fruits, &quot;[aeiou]&quot;) #&gt; [1] &quot;n ppl&quot; &quot;tw prs&quot; &quot;thr bnns&quot; 移除文本中空格 str_replace_all(string = &#39; d a b &#39;,pattern = &#39; &#39;,replacement = &#39;&#39;) #&gt; [1] &quot;dab&quot; 5.2.8 字符排序 numeric参数决定是否按照数字排序。 str_order(x, decreasing = FALSE, na_last = TRUE, locale = &quot;en&quot;, numeric = FALSE, ...) str_sort(x, decreasing = FALSE, na_last = TRUE, locale = &quot;en&quot;, numeric = FALSE, ...) str_order(letters) #&gt; [1] 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 #&gt; [26] 26 str_sort(letters) #&gt; [1] &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot; &quot;e&quot; &quot;f&quot; &quot;g&quot; &quot;h&quot; &quot;i&quot; &quot;j&quot; &quot;k&quot; &quot;l&quot; &quot;m&quot; &quot;n&quot; &quot;o&quot; &quot;p&quot; &quot;q&quot; &quot;r&quot; &quot;s&quot; #&gt; [20] &quot;t&quot; &quot;u&quot; &quot;v&quot; &quot;w&quot; &quot;x&quot; &quot;y&quot; &quot;z&quot; numeric参数 x &lt;- c(&quot;100a10&quot;, &quot;100a5&quot;, &quot;2b&quot;, &quot;2a&quot;) str_sort(x) #&gt; [1] &quot;100a10&quot; &quot;100a5&quot; &quot;2a&quot; &quot;2b&quot; str_sort(x, numeric = TRUE) #&gt; [1] &quot;2a&quot; &quot;2b&quot; &quot;100a5&quot; &quot;100a10&quot; 5.2.9 提取单词 从句子中提取单词。 参数 word(string, start = 1L, end = start, sep = fixed(&quot; &quot;)) 案例 sentences &lt;- c(&quot;Jane saw a cat&quot;, &quot;Jane sat down&quot;) word(sentences, 2, -1) #&gt; [1] &quot;saw a cat&quot; &quot;sat down&quot; word(sentences[1], 1:3, -1) #&gt; [1] &quot;Jane saw a cat&quot; &quot;saw a cat&quot; &quot;a cat&quot; 指定分隔符 # Can define words by other separators str &lt;- &#39;abc.def..123.4568.999&#39; word(str, 1, sep = fixed(&#39;..&#39;)) #&gt; [1] &quot;abc.def&quot; word(str, 2, sep = fixed(&#39;..&#39;)) #&gt; [1] &quot;123.4568.999&quot; 5.2.10 其他函数 str_subset() str_which() 匹配字符串本身行筛选时候能用 fruit &lt;- c(&quot;apple&quot;, &quot;banana&quot;, &quot;pear&quot;, &quot;pinapple&quot;) str_subset(fruit, &quot;a&quot;) #&gt; [1] &quot;apple&quot; &quot;banana&quot; &quot;pear&quot; &quot;pinapple&quot; str_which(fruit, &quot;a&quot;) # 匹配字符首次出现的位置 #&gt; [1] 1 2 3 4 #str_which 是which(str_detect(x,pattern))的包装 #str_which() #str_subset是对x[str_detect(x,pattern)]的包装 #str_subset() #筛选出字母行 set.seed(24) dt &lt;- data.table::data.table(col=sample(c(letters,1:10),100,replace = T)) head(dt[str_which(col,pattern = &#39;[a-z]&#39;)]) str_dup() 复制字符串 fruit &lt;- c(&quot;apple&quot;, &quot;pear&quot;, &quot;banana&quot;) str_dup(fruit, 2) str_dup(fruit, 1:3) str_c(&quot;ba&quot;, str_dup(&quot;na&quot;, 0:5)) str_starts() str_ends() 从str_detect()包装得到. str_starts(&#39;abd&#39;,&#39;a&#39;) #&gt; [1] TRUE str_detect(&#39;abd&#39;,&#39;^a&#39;) #&gt; [1] TRUE str_ends(&#39;abd&#39;,&#39;d&#39;) #&gt; [1] TRUE str_detect(&#39;abd&#39;,&#39;a$&#39;) #&gt; [1] FALSE 大小写转换 dog &lt;- &quot;The quick brown dog&quot; str_to_upper(dog) #&gt; [1] &quot;THE QUICK BROWN DOG&quot; str_to_lower(dog) #&gt; [1] &quot;the quick brown dog&quot; str_to_title(dog) #&gt; [1] &quot;The Quick Brown Dog&quot; str_to_sentence(&quot;the quick brown dog&quot;) #&gt; [1] &quot;The quick brown dog&quot; "],["r实现excel字符函数.html", "5.3 R实现Excel字符函数", " 5.3 R实现Excel字符函数 以下函数实现，仅仅只是从stringr包的函数上修改，并且没有完善，没有报错提示等的简陋版本，如果感兴趣的可以尝试利用Rcpp写出高性能版本的同功能函数。 left r_left &lt;- function(str,num){ str_sub(string = str,start = 1,end = num) } r_left(&#39;我是R语言学习者&#39;,3) #&gt; [1] &quot;我是R&quot; right r_right &lt;- function(str,num){ str_sub(string = str,start = str_length(str) - num + 1) } r_right(&#39;我是R语言学习者&#39;,3) #&gt; [1] &quot;学习者&quot; mid r_mid &lt;- function(str,start,num){ str_sub(string = str,start = start,end = start + num -1) } r_mid(&#39;我是R语言学习者&#39;,3,3) #&gt; [1] &quot;R语言&quot; 其余函数可以自行实现 "]]
